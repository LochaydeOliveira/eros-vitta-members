Eros Vitta Members - Progresso do Projeto

1) O que já foi feito
- Backend PHP puro estruturado (compatível HostGator):
  - public/index.php (roteador), public/.htaccess (rewrite + vars de ambiente)
  - src/* (Router, bootstrap, Config, Database, Http/JsonResponse, Security/Jwt, Middleware/AuthMiddleware)
  - Controllers: AuthController, AdminAuthController, ProductController, AccessController, DownloadController, WebhookController, TestEmailController
  - Mail: SMTP Zoho implementado em src/Mail/Mailer.php (SSL 465 / TLS 587) com fallback para mail()
- Banco de dados (externo ao código):
  - Script SQL enviado anteriormente: schema completo, índices, views para dashboard e snapshots materializados com procedures e EVENT/CRON
- Endpoints disponíveis:
  - GET  /api/health
  - POST /api/test/email (temporário, protegido por APP_KEY)
  - POST /api/auth/register
  - POST /api/auth/login
  - POST /api/auth/password/forgot
  - POST /api/auth/password/reset
  - GET  /api/auth/me (JWT)
  - POST /api/admin/login
  - GET  /api/products (JWT)
  - GET  /api/accesses (JWT)
  - POST /api/downloads/token (JWT)
  - GET  /api/downloads/file?token=...
  - POST /api/hotmart/webhook
- Documentação:
  - README.md na raiz com instruções de configuração, rotas e SMTP Zoho
- Organização de projeto corrigida:
  - Código movido para a raiz (public/, src/, README.md)
  - Subpasta antiga eros-vitta/ removida

2) Onde paramos
- Deploy realizado e API online (ex.: https://erosvitta.com.br)
- Conexão com DB validada via POST /api/diag/db (ok)
- Login admin VALIDADO com sucesso em produção (POST /api/admin/login): OK
- Admin usado: lochaydeguerreiro@hotmail.com (ativo=1, senha atualizada com Bcrypt)

3) O que falta para continuar
- Operacional imediato:
  - Remover/ocultar endpoints de diagnóstico (/api/diag/*) após fim dos testes
  - Criar um segundo admin de backup e guardar senhas com gerenciador
  - Testar rotas admin com JWT (ex.: GET /api/admin/users)
- Deploy e smoke test (contínuo):
  - Health: GET /api/health
  - (opcional) E-mail: POST /api/test/email; após sucesso, remover por segurança
- Painel Admin (backoffice):
  - Rotas para CRUD de produtos (upload, editar, deletar)
  - CRUD de clientes (listar/editar/bloquear/desbloquear, resetar senha)
  - Atribuir produtos manualmente a clientes
  - Dashboard usando as views e snapshots (resumo, faturamento diário/mensal, top produtos)
- Front-end Área do Membro (React + Tailwind + shadcn/ui):
  - Login, catálogo (Ebooks/Áudios), Perfil
  - Visualização de PDFs (PDF.js) e player de áudio (Wavesurfer.js)
  - Estados: comprado, bloqueado, CTA comprar
- Segurança e robustez:
  - Validação HMAC real do webhook Hotmart
  - Rate limiting em login e webhook
  - Logs/observabilidade (falhas de e-mail/webhook)
  - Proteção da mídia (armazenamento fora do public/, streaming autenticado)
  - Watermark opcional para PDFs
- Operacional:
  - CRON diário para snapshots (se EVENT_SCHEDULER indisponível)
  - Backups do banco e retenção

4) Como testar depois do deploy
- Confirmar apontamento de domínio/subdomínio -> public/
- Health:
  curl -s https://SEU_DOMINIO/api/health
- DB (diag):
  curl -sS -X POST 'https://SEU_DOMINIO/api/diag/db' \
    -H 'Content-Type: application/json' \
    -d '{"key":"APP_KEY_AQUI"}'
- Gerar hash Bcrypt (diag):
  curl -sS -X POST 'https://SEU_DOMINIO/api/diag/hash' \
    -H 'Content-Type: application/json' \
    -d '{"key":"APP_KEY_AQUI","senha":"SENHA_DESEJADA"}'
- Validar admin no DB (diag):
  curl -sS -X POST 'https://SEU_DOMINIO/api/diag/admin-auth' \
    -H 'Content-Type: application/json' \
    -d '{"key":"APP_KEY_AQUI","email":"EMAIL_ADMIN","senha":"SENHA_DESEJADA"}'
- Login admin (produção):
  curl -sS -X POST 'https://SEU_DOMINIO/api/admin/login' \
    -H 'Content-Type: application/json' \
    -d '{"email":"EMAIL_ADMIN","senha":"SENHA_DESEJADA"}'

5) Notas
- Não commitar APP_KEY/SMTP_PASS. Use variáveis no .htaccess/ambiente do servidor.
- Ao trocar APP_KEY, os JWTs antigos expiram na prática (usuários logam novamente).
- Os arquivos de mídia devem ficar fora da pasta public/ e ser servidos por rota autenticada.




Token
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOjIsImVtYWlsIjoibG9jaGF5ZGVndWVycmVpcm9AaG90bWFpbC5jb20iLCJyb2
xlIjoiYWRtaW4iLCJpYXQiOjE3NTc0NDk4ODUsImV4cCI6MTc1NzUzNjI4NX0.je67Qx2KSWyySa3ezDrzEDjKzH2aREQi_ysHcrtWVxA


curl -sS 'https://erosvitta.com.br/api/admin/users' \
  -H 'Authorization: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOjIsImVtYWlsIjoibG9jaGF5ZGVndWVycmVpcm9AaG90bWFpbC5jb20iLCJyb2
xlIjoiYWRtaW4iLCJpYXQiOjE3NTc0NDk4ODUsImV4cCI6MTc1NzUzNjI4NX0.je67Qx2KSWyySa3ezDrzEDjKzH2aREQi_ysHcrtWVxA'